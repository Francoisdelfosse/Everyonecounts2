<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>World Population & Budget Allocation</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Bebas Neue', sans-serif;
      background-color: black;
      color: white;
      text-align: center;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      justify-content: center;
    }
    #population {
      font-size: 12vw;
      letter-spacing: 0.05em;
      margin: 0;
      user-select: none;
    }
    h2 {
      margin-top: 10px;
      font-weight: normal;
      font-size: 3vw;
      letter-spacing: 0.1em;
      user-select: none;
    }
    .slider-container {
      width: 90vw;
      max-width: 600px;
      margin-top: 40px;
      text-align: left;
    }
    label {
      font-size: 1.4vw;
      display: block;
      margin-bottom: 6px;
      user-select: none;
    }
    input[type=range] {
      width: 100%;
      margin-bottom: 15px;
    }
    .caption {
      font-size: 1vw;
      color: #bbb;
      margin-top: -12px;
      margin-bottom: 24px;
      user-select: none;
    }
  </style>
</head>
<body>

  <div id="population">Loading...</div>
  <h2>World Budget Allocation</h2>

  <div class="slider-container">
    <label for="health">Healthcare: <span id="healthVal">50</span>%</label>
    <input type="range" id="health" min="0" max="100" value="50" />
    <div class="caption">More healthcare slowly improves life expectancy over ~15 years.</div>
  </div>

  <div class="slider-container">
    <label for="education">Education: <span id="educationVal">50</span>%</label>
    <input type="range" id="education" min="0" max="100" value="50" />
    <div class="caption">Better education improves societal health and birth rates gradually (~15 years).</div>
  </div>

  <div class="slider-container">
    <label for="climate">Climate: <span id="climateVal">50</span>%</label>
    <input type="range" id="climate" min="0" max="100" value="50" />
    <div class="caption">Cleaner energy & environment reduce mortality slowly over ~15 years.</div>
  </div>

  <div class="slider-container">
    <label for="war">War/Pandemic Response: <span id="warVal">50</span>%</label>
    <input type="range" id="war" min="0" max="100" value="50" />
    <div class="caption">War & pandemics increase death rates quickly but effects fade over ~5 years.</div>
  </div>

<script>
  // Anchor data: Jan 1, 2025 population estimate & base growth rate
  const basePopulation = 8079200000;
  const baseDate = new Date("2025-01-01T00:00:00Z").getTime();
  const baseGrowthRate = 0.008; // ~0.8% per year (approximate)

  // Slider influence configuration (weight & lag in years)
  const sliderConfigs = {
    health: { weight: 0.002, lagYears: 15 },
    education: { weight: 0.002, lagYears: 15 },
    climate: { weight: 0.001, lagYears: 15 },
    war: { weight: -0.003, lagYears: 5 }
  };

  // Store slider targets and smoothed effective values
  const sliders = {
    health: 50,
    education: 50,
    climate: 50,
    war: 50
  };
  const effectiveSliders = {
    health: 50,
    education: 50,
    climate: 50,
    war: 50
  };

  function lerp(a, b, t) {
    return a + (b - a) * t;
  }

  // Update target slider values on input
  function updateTarget(id, val) {
    sliders[id] = val;
    document.getElementById(id + "Val").textContent = val;
  }

  // Gradually update effective slider values toward targets based on lag
  function updateEffectiveSliders(deltaTime) {
    for (const id in sliders) {
      const cfg = sliderConfigs[id];
      const target = sliders[id];
      const current = effectiveSliders[id];
      // Calculate smoothing factor based on lag time (in seconds)
      // deltaTime in seconds, lagYears converted to seconds
      const lagSeconds = cfg.lagYears * 365.25 * 24 * 3600;
      const smoothing = 1 - Math.exp(-deltaTime / lagSeconds);
      effectiveSliders[id] = lerp(current, target, smoothing);
    }
  }

  // Calculate current growth rate based on effective sliders
  function calcGrowthRate() {
    let rate = baseGrowthRate;
    for (const id in effectiveSliders) {
      // slider range 0-100, offset by 50 â†’ -50 to +50
      const offset = (effectiveSliders[id] - 50) / 50;
      rate += offset * sliderConfigs[id].weight;
    }
    return rate;
  }

  // Calculate current population based on growth rate and elapsed time since baseDate
  let lastTimestamp = null;
  let currentPopulation = basePopulation;

  function update(timestamp) {
    if (!lastTimestamp) lastTimestamp = timestamp;
    const deltaMs = timestamp - lastTimestamp;
    lastTimestamp = timestamp;
    const deltaSec = deltaMs / 1000;

    updateEffectiveSliders(deltaSec);
    const growthRate = calcGrowthRate();

    // Update population with exponential growth: P(t+dt) = P(t) * e^(r*dt)
    currentPopulation *= Math.exp(growthRate * (deltaSec / (365.25 * 24 * 3600)));

    // Display population without commas or decimals
    document.getElementById("population").textContent = Math.floor(currentPopulation);

    requestAnimationFrame(update);
  }

  // Event listeners for sliders
  ["health", "education", "climate", "war"].forEach(id => {
    const slider = document.getElementById(id);
    slider.addEventListener("input", e => updateTarget(id, Number(e.target.value)));
    // Initialize display values
    document.getElementById(id + "Val").textContent = slider.value;
  });

  // Start animation
  requestAnimationFrame(update);
</script>
</body>
</html>
